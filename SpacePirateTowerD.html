<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Space Pirate Defense</title>
		<script ty pe="text/javascript" src="phaser.min.js"></script>
		<script type="text/javascript" src="tower.js"></script>
		<script type="text/javascript" src="brigBlaster.js"></script>
		<script type="text/javascript" src="clipCatast.js"></script>
		<script type="text/javascript" src="fleetSinker.js"></script>
		<!--Enemy Ships-->
		<script type="text/javascript" src="enemyClass.js"></script>
		<script type="text/javascript" src="enemyS-BrethrenOfTheCoast.js"></script>
		<script type="text/javascript" src="enemyS-ScourgeOfTheSevenSeas.js"></script>
		<script type="text/javascript" src="enemyS-TheSquirrel.js"></script>
		<script type="text/javascript" src="enemyS-RoyalFortune.js"></script>
		<script type="text/javascript" src="enemyS-FlyingDragon.js"></script>
		<script type="text/javascript" src="enemyS-AdmiralOfTheBlack.js"></script>
		
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>

<body>

<script type="text/javascript">
var game = new Phaser.Game(1920, 1920, Phaser.AUTO, '', { preload: preload, create: create, update: update, render: render});
//***************************
// Phaser Standard Functions
//***************************
//load necessary game assets
function preload() {
    //load map
    game.load.tilemap('pirateMapOcean', 'pirateMapProto4-2.json', null, Phaser.Tilemap.TILED_JSON);
    
    //Load Images
    game.load.image('tiles', 'tiles_sheet.png');
    game.load.image('sendNextWaveButtn', 'SendWaveRed.png');
    game.load.image('tree', 'Tree_1.png');
    game.load.image('shipsMisc3', '2nd_ship_new_3.png');
    game.load.atlasXML('shipsMisc1','shipsMiscellaneous_sheet.png','shipsMiscellaneous_sheet.xml');
    game.load.atlasXML('shipsMisc2','shipsMiscellaneous_sheet@2.png','shipsMiscellaneous_sheet@2.xml');
    game.load.image('villager', 'spr_m_unko.png'); 
    game.load.atlasXML('spaceItems', 'spaceItems.png', 'spaceItems.xml');
    game.load.image('star', 'star.png');
    game.load.image('navbar','gameNavBarLogo.png');
    game.load.image('village','village.png');
    
    //Google Web Fonts For Text Editing
    // game.load.script('webfont', '//ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js');
    
    game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
    
}
//***************************
// Global Variables
//***************************
    
var map;
var layer;
var sendWaveButton;

//MenuBarVariables
var navbar;
var currentLevel,level;
var wave, currentWave;

//Sprites from spaceItems
var brigBlasterTower;
var clipCatastTower;
var fleetSinkerTower;

//Player Current Gold
var currentGold, goldMeter;
    
//Tower Groups
var berzerkers;
//Ranage Tower Group
var towerRange;
//Groups
var enemies;
//Tower weapons
var weaponBrigBlaster;
var weaponClipCatast;
var weaponFleetSinker;
var spTree;
var villager1;
var village;

//Self Made Path Variables
var level1Path = [];
var path1,path2,path3,path4,path5;
var timeoutIndex =0;
function create() {
    
    game.physics.startSystem(Phaser.Physics.ARCADE);
    
    //to load the map into the map
    map = game.add.tilemap('pirateMapOcean');
    //add the tileset from the json file
    map.addTilesetImage('tiles_sheet', 'tiles');
    
    
    layer = map.createLayer('Ground');
    layer.scale.y = .95;
    layer = map.createLayer('Background');
    layer.scale.y = .95;
    layer = map.createLayer('Foreground');
    layer.scale.y = .95;
    layer = map.createLayer('TowerCollision');
    layer.scale.y = .95;

    navbar = game.add.sprite(0, 1760, 'navbar');
    //Send Wave Button
    sendWaveButton = game.add.sprite(250,1800,'sendNextWaveButtn');
    sendWaveButton.inputEnabled = true;
    sendWaveButton.scale.x = 1.5;
    sendWaveButton.scale.y = 1.5;
    

    //CurrentLevelTextOnNavBar Initalize
    currentLevel = "Level 1";
    currentLevelName = "Tortuga";
    currentWave = '0 / 10';
    level = game.add.text(20,1800, currentLevel, { font: "40px Arial", fill: "#EBEBEB" });
    levelName = game.add.text(20,1850, currentLevelName, { font: "40px Arial", fill: "#7FFFD4" });
    game.add.text(277,1845, 'Wave:', { font: "30px Arial", fill: "#EBEBEB" });
    wave = game.add.text(280,1880, currentWave, { font: "30px Arial", fill: "#E74C3C" });
    
    currentGold = 250;  //Init player with 250 gold to start game
    game.add.text(510,1845, 'Gold:', { font: "30px Arial", fill: "#EBEBEB" });
    goldMeter = game.add.text(530,1880, currentGold, { font: "30px Arial", fill: "#F1C40F" });
    
    //to create group for berzerker towers
    berzerkers = game.add.group();
    towerRange = game.add.group();
    
    //Init first tower objects
    brigBlasterTower = new BrigBlasterTower(game);
    clipCatastTower = new ClipCatastTower(game);
    fleetSinkerTower = new FleetSinkerTower(game);
    
    brigBlasterTower.events.onDragStart.add(function(){dragTower(brigBlasterTower)}, this);
    clipCatastTower.events.onDragStart.add(function(){dragTower(clipCatastTower)}, this);
    fleetSinkerTower.events.onDragStart.add(function(){dragTower(fleetSinkerTower)}, this);
    
    
    //Misc Sprites
    spTree = game.add.sprite(1400, 1100, 'tree');
    spTree.scale.x = .6;
    spTree.scale.y = .6;
    

    village = game.add.sprite(675,1030,'village');
    village.scale.x = .7;
    village.scale.y = .7;
    villager1 = game.add.sprite(908, 1024, 'villager');
    villager1.scale.x = 1.6;
    villager1.scale.y = 1.6;
    
    //Game Board Alignment
    layer.resizeWorld();
    game.scale.pageAlignVertically = true;
    game.scale.pageAlignHorizontally = true; 
    game.scale.refresh();
    //Enemies
    enemies = game.add.group();
    game.physics.arcade.enable(enemies);
   
 
     //Self Made Path Variables
    path1 = [{x:200,y:500},{x:1695,y:500},{x:1695,y:840},{x:70,y:840},{x:70,y:1715},{x:2500,y:1715}];
    path2 = [{x:200,y:500},{x:1150,y:500},{x:1150,y:190},{x:1695,y:190},{x:1695,y:840},{x:70,y:840},{x:70,y:1715},{x:2500,y:1715}];
    //Path 3 goes around the first island
    path3 = [{x:200,y:500},{x:510,y:500},{x:510,y:840},{x:1050,y:840},{x:1050,y:1390},{x:70,y:1390},{x:70,y:1715},{x:2500,y:1715}];
    path4 = [{x:200,y:500},{x:1695,y:500},{x:1695,y:840},{x:1050,y:840},{x:1050,y:1390},{x:70,y:1390},{x:70,y:1715},{x:2500,y:1715}];
    level1Path = [path1,path2,path3,path4];
  
    //Initiate Tween
    sendWaveButton.events.onInputDown.add(wave1, this);
    
}
function update() {
    
    //Check for collision between bullets and enemies
    game.physics.arcade.overlap(brigBlasterTower.weapon.bullets, enemies, collisionCheck, null, this);
    game.physics.arcade.overlap(clipCatastTower.bullets, enemies, collisionCheck, null, this);
    game.physics.arcade.overlap(fleetSinkerTower.bullets, enemies, collisionCheck, null, this);
   
}
//Removes enemies killed
function collisionCheck(star, enemy){
    console.log("HEALTH " + enemy.health);
    console.log("CURRENT DAMAGE " + star.data.bulletManager.damage);
    
    
    if(enemy.health > 0){
        
        enemy.health -= star.data.bulletManager.damage;
    }
    else{
        enemy.destroy();
    }    
        star.kill();
}
 
    
function render(){
    
    game.debug.body(berzerkers);
}
//================================
//ENEMY LEVEL 1 WAVES
function wave1() {
    setWave('1 / 10');
    sendWave(brethren,10,level1Path,null,
    wrapSendWave(scourge,1,level1Path,null,
    wrapSendWave(brethren,2,level1Path,null,wave2)));
    sendWaveButton.visible = false;
}
function wave2(){
    setWave('2 / 10');
    sendWaveButton.visible = true;
    sendWaveButton.events.onInputDown.removeAll();
    // sendWaveButton.events.onInputDown.add(wrapSendWave(admiral,1,level1Path,sendWaveButton), this);
    sendWaveButton.events.onInputDown.add(
        wrapSendWave(brethren,4,level1Path,sendWaveButton,
        wrapSendWave(scourge,5,level1Path,null,
        wrapSendWave(brethren,1,level1Path,null,
        wrapSendWave(scourge,5,level1Path,null,wave3)))), this);
}
function wave3(){
    setWave('3 / 10');
    sendWaveButton.visible = true;
    sendWaveButton.events.onInputDown.removeAll();
        sendWaveButton.events.onInputDown.add(
        wrapSendWave(squirrel,2,level1Path,sendWaveButton,
        wrapSendWave(scourge,5,level1Path,null,
        wrapSendWave(brethren,2,level1Path,null,
        wrapSendWave(squirrel,6,level1Path,null,wave4)))), this);
}
function wave4(){
    setWave('4 / 10');
    sendWaveButton.visible = true;
    sendWaveButton.events.onInputDown.removeAll();
        sendWaveButton.events.onInputDown.add(
        wrapSendWave(squirrel,5,level1Path,sendWaveButton,
        wrapSendWave(royal,4,level1Path,null,
        wrapSendWave(brethren,2,level1Path,null,
        wrapSendWave(scourge,9,level1Path,null,wave5)))), this);
}
function wave5(){
    setWave('5 / 10');
    sendWaveButton.visible = true;
    sendWaveButton.events.onInputDown.removeAll();
        sendWaveButton.events.onInputDown.add(
        wrapSendWave(royal,5,level1Path,sendWaveButton,
        wrapSendWave(squirrel,2,level1Path,null,
        wrapSendWave(royal,8,level1Path,null,
        wrapSendWave(dragon,1,level1Path,null,wave6)))), this);
}
function wave6(){
    setWave('6 / 10');
    sendWaveButton.visible = true;
    sendWaveButton.events.onInputDown.removeAll();
        sendWaveButton.events.onInputDown.add(
        wrapSendWave(squirrel,2,level1Path,sendWaveButton,
        wrapSendWave(dragon,5,level1Path,null,
        wrapSendWave(brethren,1,level1Path,null,
        wrapSendWave(royal,6,level1Path,null,wave7)))), this);
}
function wave7(){
    setWave('7 / 10');
    sendWaveButton.visible = true;
    sendWaveButton.events.onInputDown.removeAll();
        sendWaveButton.events.onInputDown.add(
        wrapSendWave(dragon,5,level1Path,sendWaveButton,
        wrapSendWave(royal,15,level1Path,null,wave8)), this);
}
function wave8(){
    setWave('8 / 10');
    sendWaveButton.visible = true;
    sendWaveButton.events.onInputDown.removeAll();
        sendWaveButton.events.onInputDown.add(
        wrapSendWave(squirrel,3,level1Path,sendWaveButton,
        wrapSendWave(admiral,2,level1Path,null,
        wrapSendWave(royal,10,level1Path,null,wave9))), this);
}
function wave9(){
    setWave('9 / 10');
    sendWaveButton.visible = true;
    sendWaveButton.events.onInputDown.removeAll();
        sendWaveButton.events.onInputDown.add(
        wrapSendWave(brethren,3,level1Path,sendWaveButton,
        wrapSendWave(scourge,1,level1Path,null,
        wrapSendWave(squirrel,2,level1Path,null,
        wrapSendWave(royal,2,level1Path,null,
        wrapSendWave(dragon,5,level1Path,null,
        wrapSendWave(admiral,8,level1Path,null,wave10)))))), this);
}
function wave10(){
    setWave('10 / 10');
    sendWaveButton.visible = true;
    sendWaveButton.events.onInputDown.removeAll();
        sendWaveButton.events.onInputDown.add(
        wrapSendWave(dragon,10,level1Path,sendWaveButton,
        wrapSendWave(admiral,15,level1Path,null)), this);
        
    //Next Level TEXT
    setLevel('Level 2', 'Cutthroat');
}
//ENEMY LEVEL 1 WAVES
//============================


//Nav Bar Update Functions for Text

function setLevel(levelNumberText,levelName){
    level.kill();
    levelName.kill();
    currentLevel = levelNumberText;
    currentLevelName = levelName;
    level = game.add.text(20,1800, currentLevel, { font: "40px Arial", fill: "#EBEBEB" })
    levelName = game.add.text(20,1850, currentLevelName, { font: "40px Arial", fill: "#7FFFD4" })
}

function setWave(waveText){
    wave.kill();
    wave = game.add.text(280,1880, waveText, { font: "30px Arial", fill: "#E74C3C" })
}

function setGold(goldValue){
    goldMeter.kill();
    goldMeter = game.add.text(530,1880, goldValue, { font: "30px Arial", fill: "#F1C40F" })
}


</script>

</body>
</html>